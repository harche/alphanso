name: "Openshift kubernetes rebase"
max_attempts: 100
working_directory: "kubernetes"

# Pre-actions - One-time setup
pre_actions:
  - command: "../setup.sh --fork-repo=git@github.com:harche/kubernetes.git"
    description: "Setup kubernetes fork repository"

# Main script - The goal to retry until it succeeds
main_script:
  command: "../ocp-rebase.sh --k8s-tag=v1.35.0-alpha.2 --openshift-release=release-4.22"
  description: "Rebase OpenShift kubernetes fork to upstream tag"
  timeout: 600

# Validators - Health checks (only run when main script fails)
validators:
  - type: command
    name: "Make update"
    command: "source hack/install-etcd.sh && make update"
    timeout: 900

  - type: command
    name: "Build"
    command: "make"
    timeout: 600

  - type: test-suite
    name: "Unit Tests"
    command: "make test"
    timeout: 1800

# Agent configuration
agent:
  type: "claude-agent-sdk"
  claude:
    model: "claude-sonnet-4-5@20250929"
    system_prompt_file: "prompts/rebase-assistant.txt"

retry_strategy:
  type: hybrid
